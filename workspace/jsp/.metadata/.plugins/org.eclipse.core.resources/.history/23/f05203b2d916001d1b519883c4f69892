
<%@page import="java.io.FileWriter"%>
<%@page import="java.io.File"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>

<%
	request.setCharacterEncoding("UTF-8");

	String name = request.getParameter("name");
	String email = request.getParameter("email");
	String subject = request.getParameter("subject");
	String content = request.getParameter("content");

	String attachPath = "C:/Users/HKIT/COY/attach";
	String uploadPath = attachPath + "/testFile/jspTest";
	
	java.io.File isDir = new java.io.File(uploadPath);
	
	if(isDir.exists()) {
		System.out.println("디렉토리 존재함..");
		try {
			File f = new File(uploadFile);
			
			if(f.exists()) {
				System.out.println("파일이 존재함");
				try {
					FileWriter fw = new FileWriter(uploadFile, true);
					fw.write(content);
					fw.close();
					System.out.println("저장 성공..");
					response.sendRedirect("_08_directoryList.jsp");
				} catch(Exception e) {
					//e.printStackTrace();
					System.out.println("저장 실패..");
					response.sendRedirect("_08_directoryList.jsp");
				}
			} else {
				System.out.println("파일이 존재하지 않음");
				if(f.createNewFile()) {
					System.out.println("파일 생성됨 : " + f.getName());
					String sampleStr = "";
					//줄바꿈 : /n
					content += name + ",";
					content += email + ",";
					content += subject + ",";
					content += content + "|";
					
					try {
						FileWriter fw = new FileWriter(uploadFile, true);
						fw.write(content);
						fw.close();
						System.out.println("저장 성공..");
						response.sendRedirect("_08_directoryList.jsp");
					} catch(Exception e) {
						//e.printStackTrace();
						System.out.println("저장 실패..");
						response.sendRedirect("_08_directoryList.jsp");
					}
				} else {
					System.out.println("파일 생성되지 않음..");
				}
			}
	} else {
		System.out.println("디렉토리 존재하지 않음..");
		
		try {
			isDir.mkdirs();
			System.out.println("디렉토리 생성 성공..");
			String uploadFile = uploadPath + "/sample.txt";
			
			File f = new File(uploadFile);
			
			if(f.exists()) {
				System.out.println("파일이 존재함");
			} else {
				System.out.println("파일이 존재하지 않음");
				if(f.createNewFile()) {
					System.out.println("파일 생성됨 : " + f.getName());
					String sampleStr = "";
					//줄바꿈 : /n
					content += name + ",";
					content += email + ",";
					content += subject + ",";
					content += content + "|";
					
					try {
						FileWriter fw = new FileWriter(uploadFile, true);
						fw.write(content);
						fw.close();
						System.out.println("저장 성공..");
						response.sendRedirect("_08_directoryList.jsp");
					} catch(Exception e) {
						//e.printStackTrace();
						System.out.println("저장 실패..");
						response.sendRedirect("_08_directoryList.jsp");
					}
				} else {
					System.out.println("파일 생성되지 않음..");
				}
			}
		} catch(Exception e) {
			System.out.println("디렉토리 생성 실패..");
		}
		
	}
%>
